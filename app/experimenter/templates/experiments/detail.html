{% extends "base.html" %}

{% load static %}

{% block breadcrumbs %}
{% endblock %}

{% block content_header %}

  <div class="col-md-9">
    <a class="noanchorstyle spaced-text" href="{% url "experiments-detail" slug=experiment.slug %}">
      {{ object.name }}
    </a>
    <span class="badge status-color-{{ experiment.status }}">{{ experiment.status }}</span>
  </div>


{% endblock %}

{% block content %}
  <div class="row md-mt-20">

    <div class="col-md-9 md-pr-40">

      <div class="row">
        <h4 class="col-md-8 md-mt-0">
          Overview
        </h4>

        {% if experiment.is_draft %}
          <div class="col-md-4 text-right">
            <a class="noanchorstyle" href="{% url "experiments-overview-update" slug=object.slug %}"><h5><span class="glyphicon glyphicon-pencil"></span> Edit</h5></a>
          </div>
        {% endif %}
      </div>

      <div class="row card md-pt-15 md-pb-10">
        {% if object.is_launched %}
          <iframe style="display:block" scrolling="no" frameBorder="0" width="100%" height="450px" src="{{ object.enrollment_dashboard_url }}" ></iframe>
        {% else %}
          <div class="col-md-6">
            <p><strong>{{ object.proposed_start_date }} - {{ object.proposed_end_date }}</strong></p>
          </div>
          <div class="col-md-6 text-right">
            <h4 class="md-mt-0">{{ object.population }}</h4>
          </div>
          <div class="col-md-12 md-mt-10">
            {{ object.short_description|linebreaks }}
          </div>
        {% endif %}
      </div>

      <div class="row md-mt-20">
        <h4 class="col-md-8">
          {% if not object.completed_variants %}
            <span class="icon-warning glyphicon glyphicon-exclamation-sign"></span>
          {% endif %}
          Firefox Pref &amp; Branches
        </h4>

        {% if experiment.is_draft %}
          <div class="col-md-4 text-right">
            <a class="noanchorstyle" href="{% url "experiments-variants-update" slug=object.slug %}"><h5><span class="glyphicon glyphicon-pencil"></span> Edit</h5></a>
          </div>
        {% endif %}
      </div>

      <div class="row card md-pt-15 md-pb-10">
        {% if object.variants.all %}
          {% for variant in object.variants.all %}
            <div class="col-md-12 {% if not forloop.last %}md-mb-15{% endif %}">
              <h4 class="md-mt-0">{{ variant.ratio }}% {{ variant.name }}</h4>
              <p><strong>{{ object.pref_key }} = <span class="text-info">{{ variant.value }}</span></strong></p>
              <p>{{ variant.description }}</p>

            </div>
          {% endfor %}
        {% else %}

          <p class="col-md-12">You must <a href="{% url "experiments-variants-update" slug=object.slug %}">define your branches</a> before you can launch your experiment.</p>
        {% endif %}

      </div>

      <div class="row md-mt-20">
        <h4 class="col-md-8">
          {% if not object.completed_objectives %}
            <span class="icon-warning glyphicon glyphicon-exclamation-sign"></span>
          {% endif %}
          Objectives
        </h4>

        {% if experiment.is_draft %}
          <div class="col-md-4 text-right">
            <a class="noanchorstyle" href="{% url "experiments-objectives-update" slug=object.slug %}"><h5><span class="glyphicon glyphicon-pencil"></span> Edit</h5></a>
          </div>
        {% endif %}
      </div>

      <div class="row card md-pt-15 md-pb-10">
        <div class="col-md-12">
          {% if object.completed_objectives %}
            {{ object.objectives|linebreaks }}
          {% else %}
            <p>You must <a href="{% url "experiments-objectives-update" slug=object.slug %}">define the objectives</a> before you can launch your experiment.</p>
          {% endif %}
        </div>
      </div>

      <div class="row md-mt-20">
        <h4 class="col-md-8">
          {% if not object.completed_objectives %}
            <span class="icon-warning glyphicon glyphicon-exclamation-sign"></span>
          {% endif %}
          Analysis
        </h4>

        {% if experiment.is_draft %}
          <div class="col-md-4 text-right">
            <a class="noanchorstyle" href="{% url "experiments-objectives-update" slug=object.slug %}"><h5><span class="glyphicon glyphicon-pencil"></span> Edit</h5></a>
          </div>
        {% endif %}
      </div>

      <div class="row card md-pt-15 md-pb-10">
        <div class="col-md-12">
          {% if object.completed_objectives %}
            {{ object.analysis|linebreaks }}
          {% else %}

            <p>You must <a href="{% url "experiments-objectives-update" slug=object.slug %}">define the analysis plan</a> before you can launch your experiment.</p>
          {% endif %}
        </div>
      </div>

      <div class="row md-mt-20">
        <h4 class="col-md-8">
          {% if not object.completed_risks %}
            <span class="icon-warning glyphicon glyphicon-exclamation-sign"></span>
          {% endif %}
          Risk Assessment
        </h4>

        {% if experiment.is_draft %}
          <div class="col-md-4 text-right">
            <a class="noanchorstyle" href="{% url "experiments-risks-update" slug=object.slug %}"><h5><span class="glyphicon glyphicon-pencil"></span> Edit</h5></a>
          </div>
        {% endif %}
      </div>

      <div class="row card md-pt-15 md-pb-10">
        <div class="col-md-12">
          {% if object.completed_risks %}
            <p><strong>{{ object.RISK_PARTNER_RELATED_LABEL }}</strong></p>
            <p>{{ object.risk_partner_related|yesno:"Yes,No" }}</p>

            <p><strong>{{ object.RISK_BRAND_LABEL }}</strong></p>
            <p>{{ object.risk_brand|yesno:"Yes,No" }}</p>

            <p><strong>{{ object.RISK_FAST_SHIPPED_LABEL }}</strong></p>
            <p>{{ object.risk_fast_shipped|yesno:"Yes,No" }}</p>

            <p><strong>{{ object.RISK_CONFIDENTIAL_LABEL }}</strong></p>
            <p>{{ object.risk_confidential|yesno:"Yes,No" }}</p>

            <p><strong>{{ object.RISK_RELEASE_POPULATION_LABEL }}</strong></p>
            <p>{{ object.risk_release_population|yesno:"Yes,No" }}</p>

            {% if object.is_high_risk %}
              <h5>RASCI Owners and Deliverables</h5>
              {{ object.risks|linebreaks }}
            {% endif %}
          {% else %}
            <p>You must <a href="{% url "experiments-risks-update" slug=object.slug %}">define the risks</a> before you can launch your experiment.</p>
          {% endif %}
        </div>
      </div>

      <div class="row md-mt-20">
        <h4 class="col-md-8">
          {% if not object.completed_risks %}
            <span class="icon-warning glyphicon glyphicon-exclamation-sign"></span>
          {% endif %}
          Testing Plan
        </h4>

        {% if experiment.is_draft %}
          <div class="col-md-4 text-right">
            <a class="noanchorstyle" href="{% url "experiments-risks-update" slug=object.slug %}"><h5><span class="glyphicon glyphicon-pencil"></span> Edit</h5></a>
          </div>
        {% endif %}
      </div>

      <div class="row card md-pt-15 md-pb-10">
        <div class="col-md-12">
          {% if object.completed_risks %}
            {{ object.testing|linebreaks }}
          {% else %}
            <p>You must <a href="{% url "experiments-risks-update" slug=object.slug %}">define the QA plan</a> before you can launch your experiment.</p>
          {% endif %}
        </div>
      </div>

    </div>

    <div class="col-md-3">

      {% if experiment.is_draft %}
        {% if object.is_ready_for_review %}
          <form
            action="{% url "experiments-status-update" slug=experiment.slug %}"
            method="POST"
          >
            {% csrf_token %}
            <input type="hidden" name="status" value="{{ experiment.STATUS_REVIEW }}" />
            <input
              type="submit"
              id="launch-button"
              class="col-md-12 md-mb-10 btn btn-success"
              value="Submit for Review"
            />
          </form>
        {% else %}
          <input
            type="submit"
            id="launch-button"
            class="col-md-12 md-mb-10 btn btn-success disabled"
            value="Submit for Review"
          />
          <div class="row form-group">
            <div class="col-md-12">
                <p class="help-block">You must complete every section before you can launch this experiment.</p>
            </div>
          </div>
        {% endif %}
      {% endif %}

      {% if experiment.is_in_review %}
        <form
          action="{% url "experiments-status-update" slug=experiment.slug %}"
          method="POST"
          class="md-mb-20"
        >
          {% csrf_token %}
          <input type="hidden" name="status" value="{{ experiment.STATUS_DRAFT }}" />
          <input
            type="submit"
            id="launch-button"
            class="col-md-12 md-mb-10 btn btn-warning"
            value="Cancel Review Request"
          />
        </form>
      {% endif %}

      <h5>History</h5>
      {% for change in object.changes.all reversed %}
        <div class="row help-block">
          <div class="col-md-12">
            <p>{{ change.changed_on.date }}</p>
          </div>
          <hr/>
          <div class="col-md-6">
            <p>{{ change.changed_by }}</p>
          </div>
          <div class="col-md-6 text-right">
            <p>{{ change.pretty_status }}</p>
          </div>
        </div>
      {% endfor %}

    </div>
  </div>
{% endblock %}
